

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FTLã‚¢ã‚²ã‚¢ã‚²ãŠåœŸç”£ã‚ã¿ã ãã˜</title>
  <style>
    body {
  font-family: sans-serif;
  text-align: center;
  margin: 20px;
  background-image: url("https://sudachiminori.com/wp-content/uploads/2024/10/%E3%81%9A%E3%82%93%E3%81%A0%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B32.png");
  background-size: cover;
  background-position: center;
  background-repeat: repeat;
}
    canvas {
      border: 1px solid #ccc;
      background: #fff;
      margin-top: 20px;
      display: block;
      margin-left: auto;
      margin-right: auto;
      max-width: 100%;
      height: auto;
    }
    #result { margin-top: 20px; font-size: 1.5em; font-weight: bold; color: green; text-align: center;}
    input[type="text"] { width: 90%; padding: 10px; font-size: 1em; }
    button { margin: 10px; padding: 10px 20px; font-size: 1em; }
    .start-button { margin: 5px; }
  </style>
</head>
<body>

<h1>ğŸ¯ FTLã‚¢ã‚²ã‚¢ã‚²ãŠåœŸç”£ã‚ã¿ã ãã˜ ğŸ¯</h1>
<p>æ™¯å“ï¼ˆå½¢å¼ï¼šA:2,B:1,C:3ï¼‰<br><input type="text" id="prizes" placeholder="1ç­‰:1,2ç­‰:2,å‚åŠ è³:3"></p>
<button id="setupButton">ãã˜ã‚’æº–å‚™ï¼</button>

<div id="buttons"></div>
<canvas id="canvas"></canvas>
<div id="result"></div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const scale = window.devicePixelRatio || 1;
const maxWidth = 700;
const displayWidth = Math.min(window.innerWidth * 0.95, maxWidth);
const displayHeight = 500;
canvas.width = displayWidth * scale;
canvas.height = displayHeight * scale;
canvas.style.width = displayWidth + "px";
canvas.style.height = displayHeight + "px";
ctx.setTransform(scale, 0, 0, scale, 0, 0);

let lines = [];
let prizes = [];
let spacingX, spacingY, rows;
let results = [];         // â† è¿½åŠ ï¼šå„å‚åŠ è€…ã®çµæœã‚’ä¿å­˜
let drawCount = 0;        // â† è¿½åŠ ï¼šãã˜ã‚’å¼•ã„ãŸäººæ•°ã‚«ã‚¦ãƒ³ãƒˆ
let totalCount = 0;       // â† è¿½åŠ ï¼šãã˜ç·æ•°ï¼ˆï¼æ™¯å“æ•°ï¼‰


document.getElementById("setupButton").addEventListener("click", setupAmidakuji);

function setupAmidakuji() {
  const prizeInput = document.getElementById("prizes").value.trim();
  const parsed = [];
  prizeInput.split(",").forEach(entry => {
    const [label, count] = entry.split(":").map(s => s.trim());
    const num = parseInt(count || "1");
    if (label && !isNaN(num)) {
      for (let i = 0; i < num; i++) parsed.push(label);
    }
  });

  if (parsed.length < 2) {
    alert("æ™¯å“ã¯2ã¤ä»¥ä¸Šå¿…è¦ã§ã™ï¼");
    return;
  }

  prizes = shuffleArray(parsed);
  totalCount = prizes.length;  // â† å…¨å“¡åˆ†ã®ãã˜ã®æ•°ã‚’è¨˜éŒ²ï¼ˆã‚ã¨ã§å¼•ã„ãŸäººæ•°ã¨æ¯”è¼ƒã™ã‚‹ãŸã‚ï¼‰
  spacingX = displayWidth / (prizes.length + 1);
  spacingY = 50;
  rows = 9;
  lines = [];
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  for (let i = 0; i < prizes.length; i++) {
    const x = spacingX * (i + 1);
    ctx.fillStyle = "black";
    ctx.textAlign = "center";
    ctx.font = "16px sans-serif";
    ctx.fillText(`${i + 1}ç•ª`, x, 20);
    ctx.fillText("ï¼Ÿï¼Ÿï¼Ÿ", x, spacingY * rows + 30);
  }

  for (let i = 0; i < prizes.length; i++) {
    const x = spacingX * (i + 1);
    ctx.beginPath();
    ctx.moveTo(x, spacingY);
    ctx.lineTo(x, spacingY * rows);
    ctx.stroke();
  }

  for (let r = 2; r < rows - 1; r++) {
    let used = new Set();
    for (let c = 0; c < prizes.length - 1; c++) {
      if (used.has(c) || used.has(c + 1)) continue;
      if (Math.random() > 0.4) {
        const x1 = spacingX * (c + 1);
        const x2 = spacingX * (c + 2);
        const y = spacingY * r;
        ctx.beginPath();
        ctx.moveTo(x1, y);
        ctx.lineTo(x2, y);
        ctx.stroke();
        lines.push({ x1, x2, y });
        used.add(c); used.add(c + 1);
      }
    }
  }

  const buttonsDiv = document.getElementById("buttons");
  buttonsDiv.innerHTML = "<p>ã©ã®åˆ—ã‹ã‚‰å¼•ãã‹é¸ã‚“ã§ãã ã•ã„ğŸ‘‡</p>";
  for (let i = 0; i < prizes.length; i++) {
    const btn = document.createElement("button");
    btn.innerText = `${i + 1} ç•ªã‚’å¼•ã`;
    btn.className = "start-button";
    btn.setAttribute("data-index", i);
    btn.addEventListener("click", (e) => {
      const index = parseInt(e.target.getAttribute("data-index"));
      animate(index);
    });
    buttonsDiv.appendChild(btn);
  }

  document.getElementById("result").innerHTML = "";
}

function animate(startCol) {
  let x = spacingX * (startCol + 1);
  let y = spacingY;
  const path = buildPath(x, y, spacingX, spacingY * rows);
  let index = 0;

  document.getElementById("result").innerHTML = `ğŸ‘‰ ${startCol + 1} ç•ªã‚’å¼•ã„ã¦ã„ã¾ã™...`;

  function step() {
  if (index >= path.length - 1) {
    const finalCol = Math.round(path[path.length - 1].x / spacingX) - 1;
    const prize = prizes[finalCol];
    document.getElementById("result").innerHTML = `ğŸ‰ çµæœã¯â€¦ã€Œ<span style="color: red;">${prize}</span>ã€ã§ã—ãŸï¼`;

    drawCount++; // â† è¿½åŠ ï¼šãã˜ã‚’å¼•ã„ãŸäººæ•°ã‚’è¨˜éŒ²

    if (drawCount === totalCount) {
      showAllResults(); // â† è¿½åŠ ï¼šå…¨å“¡å¼•ã„ãŸã‚‰ä¸€è¦§è¡¨ç¤º
    }

    return;
  }


    const current = path[index];
    const next = path[index + 1];
    const dx = (next.x - current.x) / 10;
    const dy = (next.y - current.y) / 10;
    let stepCount = 0;

    function move() {
      if (stepCount >= 10) {
        index++;
        step();
        return;
      }
      ctx.beginPath();
      ctx.arc(current.x + dx * stepCount, current.y + dy * stepCount, 4, 0, Math.PI * 2);
      ctx.fillStyle = "red";
      ctx.fill();
      stepCount++;
      setTimeout(move, 10);
    }

    move();
  }

  step();
}

function buildPath(x, y, spacingX, maxY) {
  const path = [{ x, y }];
  let currentX = x;
  let currentY = y;

  while (currentY < maxY) {
    let moved = false;
    for (const l of lines) {
      if (Math.abs(currentY - l.y) < 5) {
        if (Math.abs(currentX - l.x1) < 2) {
          path.push({ x: l.x2, y: currentY });
          currentX = l.x2;
          moved = true;
          break;
        } else if (Math.abs(currentX - l.x2) < 2) {
          path.push({ x: l.x1, y: currentY });
          currentX = l.x1;
          moved = true;
          break;
        }
      }
    }
    currentY += 10;
    path.push({ x: currentX, y: currentY });
  }

  return path;
}

function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function showAllResults() {
  const resultDiv = document.getElementById("result");
  resultDiv.innerHTML = "<h2>ğŸŠ å…¨å“¡ã®çµæœç™ºè¡¨ ğŸŠ</h2><ul style='list-style: none; padding: 0; text-align: center;'>";

  prizes.forEach((prize, index) => {
    resultDiv.innerHTML += `<li>${index + 1} ç•ª â†’ <strong>${prize}</strong></li>`;
  });

  resultDiv.innerHTML += "</ul>";
}

</script>
<script>
  // === ç”»åƒãƒ‰ãƒ­ãƒƒãƒ—ã§èƒŒæ™¯å¤‰æ›´ ===
  document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("dragover", (e) => {
      e.preventDefault();
      document.body.style.opacity = "0.8";
    });
    document.body.addEventListener("dragleave", (e) => {
      e.preventDefault();
      document.body.style.opacity = "1";
    });
    document.body.addEventListener("drop", (e) => {
      e.preventDefault();
      document.body.style.opacity = "1";

      const file = e.dataTransfer.files[0];
      if (!file || !file.type.startsWith("image/")) {
        alert("ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãã ã•ã„ï¼");
        return;
      }

      const reader = new FileReader();
      reader.onload = (event) => {
        document.body.style.backgroundImage = `url("${event.target.result}")`;
      };
      reader.readAsDataURL(file);
    });
  });
</script>

</body>
</html>
